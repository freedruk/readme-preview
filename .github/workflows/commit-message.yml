name: "PR Commit Message Lint"

on:
  pull_request:

jobs:
  commit-message-lint:
    runs-on: ubuntu-latest
    name: Check commit message prefixes

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Verify PR title follows prefix policy
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          set -euo pipefail
          echo "PR title: $PR_TITLE"

          if [ -z "$PR_TITLE" ]; then
            echo "PR title is empty; cannot validate prefix."; exit 1
          fi

          # Allowed prefixes (followed by a colon and a space):
          # fix:, feat:, chore:, docs:, refactor:, perf:, test:, style:, ci:, build:, patch:, hotfix:
          if ! echo "$PR_TITLE" | grep -E -q '^(fix|feat|chore|docs|refactor|perf|test|style|ci|build|patch|hotfix):[[:space:]]+'; then
            echo "Invalid PR title prefix: '$PR_TITLE'"
            echo "Please start PR title with one of: fix:, feat:, chore:, docs:, refactor:, perf:, test:, style:, ci:, build:, patch:, hotfix:" 
            exit 1
          fi

          echo "PR title uses an approved prefix."
